var Globals=function(){this.workspace=null,this.drop=null,this.timeline=null,this.probandList=[],this.setWorkspace=function(a){this.workspace=a},this.getWorkspace=function(){return this.workspace},this.isWorkspaceLoaded=function(){return null!=this.workspace},this.setDropData=function(a){this.drop=a},this.getDropData=function(){return this.drop},this.setTimeline=function(a){this.timeline=a},this.getTimeline=function(){return this.timeline},this.addToProbandList=function(a){this.probandList.indexOf(a)>-1||this.probandList.push(a)},this.removeFromProbandList=function(a){for(var b in this.probandList)this.probandList[b]===a&&this.probandList.splice(b,1)},this.clearProbandList=function(){this.probandList=[]},this.getProbandList=function(){return this.probandList}};window.Globals=new Globals;var Storage=function(){this.consistencyWorkspace=function(){var a=$.jStorage.get("workspaces");null==a&&$.jStorage.set("workspaces",[])},this.getWorkspaces=function(){return Storage.consistencyWorkspace(),$.jStorage.get("workspaces")},this.getListOfWorkspaces=function(){Storage.consistencyWorkspace();var a=$.jStorage.get("workspaces");if(!a)return null;var b=[];for(var c in a){var d=a[c];b.push(d.name)}return b},this.hasWorkspace=function(a){Storage.consistencyWorkspace();var b=$.jStorage.get("workspaces");for(var c in b){var d=b[c];if(d.name===a)return!0}return!1},this.loadWorkspace=function(a){Storage.consistencyWorkspace();var b=$.jStorage.get("workspaces");for(var c in b){var d=b[c];if(d.name===a)return d}return null},this.saveWorkspace=function(a){Storage.consistencyWorkspace();var b=$.jStorage.get("workspaces");for(var c in b){var d=b[c];d.name===a.name&&(b[c]=a)}$.jStorage.set("workspaces",b)},this.createWorkspace=function(a){if(Storage.consistencyWorkspace(),Storage.hasWorkspace(a.name))throw"name_conflict";var b=$.jStorage.get("workspaces");b.push(a),$.jStorage.set("workspaces",b)},this.deleteWorkspace=function(a){Storage.consistencyWorkspace();var b=$.jStorage.get("workspaces");for(var c in b){var d=b[c];d.name===a&&b.splice($.inArray(d,b),1)}$.jStorage.set("workspaces",b)},this.loadProbandData=function(a,b){return a.proband_data[b]},this.getProbands=function(a){return a.proband_data},this.saveProbandData=function(a,b,c){Storage.consistencyWorkspace(),a.proband_data[b]=c,Storage.saveWorkspace(a)},this.deleteProbandData=function(a,b){Storage.consistencyWorkspace();var c=a.proband_data;delete c[b],Storage.saveWorkspace(a)},this.importWorkspaces=function(a){if(Storage.consistencyWorkspace(),Array.isArray(a))for(var b=0;b<a.length;b++)Storage.createWorkspace(a[b]);else Storage.createWorkspace(a)}};window.Storage=new Storage;var Calculations=function(){this.getInteractionTypeFrequencyArray=function(a){var b,c={};for(var d in a){var e=a[d];b=e.interaction_type,b in c?c[b]++:c[b]=1}var f=[];for(b in c){var g=b+" ("+c[b]+")";f.push([g,c[b]])}return f}};window.Calculations=new Calculations;var Converter=function(){var a=function(){};return a.prototype.load=function(a){this.data=$.extend(!0,{},a),this.interactions=[],this.comments={},this.diary=[]},a.prototype.convertInteractions=function(){for(var a in this.data.platforms){var b=this.data.platforms[a];for(var c in b.interactions){var d=b.interactions[c],e={};e.nr=d.index,null!=d.record&&(e.interaction_type=d.record.type,e.time=d.createdAt,e.network=b.name,"open"===e.interaction_type?e.interaction_type="openFacebook":"close"===e.interaction_type&&(e.interaction_type="closeFacebook"),void 0!==d.record.object&&(e.object_id=d.record.object.id,e.object_owner=d.record.object.owner,e.object_type=d.record.object.type,void 0!==d.record.object.recipient&&(e.object_id=d.record.object.recipient)),"commentstatus"===d.record.type&&(e.object_id=d.record.target.id,e.object_owner=d.record.target.owner),void 0!==d.record.page&&(e.object_id=d.record.page),void 0!==d.record.friend&&(e.object_id=d.record.friend),this.interactions.push(e))}}},a.prototype.convertComments=function(){for(var a in this.data.platforms){var b=this.data.platforms[a];for(var c in b.comments){var d,e=b.comments[c],f=e.record.text,g=new Date(e.createdAt),h=Math.floor(g.getTime()/1e3);d=null!=e.record.id?e.record.id:Math.floor(h/100),this.comments[d]=h+" ~ "+f}}},a.prototype.convertDiary=function(){for(var a in this.data.diary){var b=this.data.diary[a];this.diary.push([b.createdAt,b.content])}},a.prototype.convert=function(){var a={};return this.convertInteractions(),this.convertComments(),this.convertDiary(),a.interactions=this.interactions,a.comments=this.comments,a.diary=this.diary,a},a}();